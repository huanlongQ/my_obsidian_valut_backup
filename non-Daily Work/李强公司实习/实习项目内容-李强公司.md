# 了解公司软硬件工作流

- 工作流: 硬件 $\to$ $\mathrm{API}$ $\to$ 控制 $\to$ $\mathrm{UI}$逻辑 $\to$ $\mathrm{UI}$ 
- 主要工具
	- `cpp`
	- `qt` [[QT学习和使用|@QT]]  

# 疑问集  

- `Qt`我们需要的主要插件是什么 $\to$ 几乎全部插件
- 什么时候开始跟软件工程师看工作流 √ 已解决
- 泽哥在做什么 
	- 他在跟各个学校对接.
	- 我能不能看他的excel任务列表? 已经看到了.  

# MyProject 设备部

- **Qt玩具 $\to$ 串口 $\to$ 网口 $\to$ 波源示波器交互 $\to$ 相机** 

## UTG900E

- [‎Gemini - C++ 连接 UTG932E 指南](https://g.co/gemini/share/14c12e5c74c3) Archive it now. 
```
Of course! I'm glad I could help.

It was a pleasure working through this with you. We started with the goal of connecting to your hardware and ended up building a professional, multi-file C++ controller based on the official manual. You've successfully navigated project configurations, linker errors, and the specific command language of your instrument, which is a fantastic achievement.

You now have a solid foundation to build your Qt GUI or any other control application you have in mind. If you decide to continue or have any other questions in the future, don't hesitate to ask.

Good luck with your project, and happy coding! 🚀
```

- [Gemini - UTG900E cpp](https://g.co/gemini/share/b1b86ab92704) 
- 配置device manager![[Pasted image 20250809000730.png|481]] 
- 配置 cpp proj![[Pasted image 20250809002444.png|662]]
- 当前问题: 由于没有示波器, 我无法使用物理手段查看输出波形, 而硬件UTG900E显示器不显示命令波形. 
	- 硬件显示:**`"正在远程控制, 按utility切到本地"`**, 不显示命令波形. 
	- cpp输出: ![[Pasted image 20250809125708.png]] 
	- ni-visa Interactive Control对各个`... read`命令return `Read Operation Error VISA: (Hex 0xBFFF0015) Timeout expired before operation completed`.
- 下一步, 控制变量法, 试图使用cpp进行语言设置. 
	- 语言设置没有问题, 可以实现转为English界面. 
- 下一步, 改为`viPrintf`, 得到新报错: ![[Pasted image 20250809140631.png|626]] 
- 查询错误代码`VISA 错误代码: 0xbfff0015` 
	- try terminal char [Solved: VISA: (HEX 0XBFFF0015) Timeout expired before operation completed - NI Community](https://forums.ni.com/t5/Instrument-Control-GPIB-Serial/VISA-HEX-0XBFFF0015-Timeout-expired-before-operation-completed/td-p/4197157) failed. 
	- try update firmware [embedded - VISA: (Hex 0xBFFF0015) Timeout expired before operation completed - Electrical Engineering Stack Exchange](https://electronics.stackexchange.com/questions/452700/visa-hex-0xbfff0015-timeout-expired-before-operation-completed) failed. ![[Pasted image 20250809140916.png|576]] 
	- 在ni visa和utg900e的manual里面都没有找到该错误代码. 
- 进一步操作, 发现问题在于输入命令错误. 
	- 输入命令不在 **`programming manual`** 规定的内容之内, 是一个随机的错误命令. 
	- 本次项目中我的问题: 
		- 在一个相对小众的领域(UTG900E的编程手册**Programming Manual**)中仍旧信任AI, 这是完全错误的. **AI只应该在通用领域内被信任**.  
		- **需要学习typical cpp project structure** $\to$ **pyhsical structure and logical structure** 

**问题来了, 既然cpp能够实现硬件控制, 我为什么不试着用python把类似的流程跑一边呢?** 

## 典型cpp项目文件结构:

一个C++项目的文件结构，我们可以从两个不同的视角来看待：

- 库的引用逻辑是: `.h` $\to$ `.lib` $\to$ `.dll`
	- `.h`是header文件, 用于通知`.cpp`哪些函数可用. 它可以放在物理文件结构的`\external\include`中, 也可以放在其他`Path`. 
	- `.lib`是linker用于链接`.dll`的文件. 它可以放在物理文件结构的`\external\lib`中, 也可以放在其他`Path`. 
	- `.dll`是实际的代码库. 它一般放在某个`Path`中. 

1. **物理结构 (Physical Structure)**: 文件和文件夹在您硬盘上的真实存储布局（您在Windows文件资源管理器里看到的样子）。
    
2. **逻辑结构 (Logical Structure)**: 您在Visual Studio的“解决方案资源管理器”中看到的虚拟组织结构。

这两者有关联，但**不一定完全相同**。

---

### **1. 典型C++项目的物理结构 (在文件资源管理器中)**

[[C++ notes .cpp&.py counterpart|@C++ notes .cpp&.py counterpart]] 
一个组织良好、可扩展的C++项目的物理目录结构，通常遵循“关注点分离”的原则。这样做的好处是让项目清晰、易于维护、方便团队协作和版本控制。

这是一个非常经典且推荐的结构：

```
MyProject/
│
├─── build/
│      # 这个文件夹用来存放所有编译生成的文件 (.obj, .exe, .dll等)。
│      # 源代码目录将保持干净。
│
├─── docs/
│      # 存放项目相关的文档，如需求文档、设计文档、用户手册等。
│
├─── external/  (或者叫 third_party, vendor)
│   │
│   ├─── include/
│   │      # 存放所有第三方库的头文件 (.h, .hpp)，例如 visa.h
│   │
│   └─── lib/
│          # 存放所有第三方库的链接文件 (.lib, .a)，例如 visa64.lib
│
├─── src/  (或者叫 source)
│   │
│   ├─── main.cpp
│   ├─── QtWidgetsApplication1.cpp
│   └─── QtWidgetsApplication1.h
│      # 项目的核心，存放所有您自己编写的源代码。
│
├─── .gitignore
│      # 如果使用Git进行版本控制，这个文件会告诉Git忽略哪些文件（比如整个build文件夹）。
│
└─── MyProject.sln
       # Visual Studio的解决方案文件，位于项目的根目录。
```

**这个结构的优点：**

- **清晰**: 您自己的代码 (`src`)、第三方依赖 (`external`)、生成产物 (`build`) 和文档 (`docs`) 完全分开，一目了然。
    
- **干净**: 编译时产生的大量中间文件都被隔离在 `build` 目录中，不会污染您的源代码区。
    
- **可移植**: 当您需要将项目发给别人或在另一台电脑上编译时，`external` 文件夹可以跟着一起走，对方不需要再单独安装这些依赖库。

---

### **2. Visual Studio的逻辑结构 (在“解决方案资源管理器”中)**

现在，我们来看看Visual Studio是如何“看待”这些文件的。VS的“解决方案资源管理器”提供的是一个**逻辑视图**，它使用**“筛选器”(Filter)** 来组织文件，主要是为了方便开发者查找。

**关键点：** VS中的“筛选器”文件夹**不一定**与硬盘上的物理文件夹一一对应。

一个典型的逻辑结构可能看起来是这样的：

```
解决方案 'MyProject' (1 个项目)
└─── MyProject
     │
     ├─── ▷ 外部依赖项 (External Dependencies)
     │      # VS自动识别并显示系统级的include文件
     │
     ├─── ▷ 头文件 (Header Files)  <- 这是一个筛选器
     │    │
     │    ├─── QtWidgetsApplication1.h   (来自物理目录 src/)
     │    └─── visa.h                    (来自物理目录 external/include/)
     │
     ├─── ▷ 源文件 (Source Files)  <- 这是一个筛选器
     │    │
     │    ├─── main.cpp                  (来自物理目录 src/)
     │    └─── QtWidgetsApplication1.cpp   (来自物理目录 src/)
     │
     └─── ▷ 资源文件 (Resource Files) <- 这是一个筛选器
```

**逻辑结构与物理结构的关系：**

- **分离**: 您可以看到，在逻辑结构中，`QtWidgetsApplication1.h` 和 `visa.h` 都被归类到了“头文件”这个筛选器下，尽管它们在硬盘上的物理位置完全不同。这纯粹是为了方便您查看。
    
- **桥梁**: 那么，编译器是如何知道去哪里找这些文件的呢？**桥梁就是我们之前一直在配置的项目属性！**
    
    - **`VC++目录 -> 包含目录`**: 您在这里添加 `external/include` 路径，就是告诉编译器：“除了默认路径，也请去这个物理文件夹里找头文件。”
        
    - **`VC++目录 -> 库目录`**: 您在这里添加 `external/lib` 路径，就是告诉链接器：“请去这个物理文件夹里找库文件。”

### **总结**

|方面|物理结构 (File Explorer)|逻辑结构 (Visual Studio)|
|---|---|---|
|**目的**|文件的**实际磁盘存储**和物理隔离|代码的**组织、分类与可视化**|
|**组织方式**|真实的文件夹 (Folder)|虚拟的“筛选器” (Filter)|
|**关系**|是项目的基础，决定了文件真实存在哪里|是项目的一种表现形式，方便开发者查看和管理|
|**如何连接**|**通过项目属性（包含目录、库目录等设置）将物理路径告知给逻辑项目**||

## MSO5000 

- 这玩意贵达18000CNY. 
	![[3ced5c92beda7bddab4f7b7ed6a2008 1.png|338]]![[2634277283f5c7a643d2d21255242d6.jpg|317]] 
- 使用LAN和USB都可以实现MSO5000$\to$PC的数据传送. 
- 可以试着叫MSO5000给PC发生数据, 用openCV实现一下图像绘制. 
- ‎[‎Gemini - 软硬件链接通信接口实现与其硬件基础](https://g.co/gemini/share/89e8857b29bb)[[软硬件链接通信接口及其硬件基础 Software Hardware link Communication Interface and its Hardware foundation|@软硬件链接通信接口及其硬件基础 Software Hardware link - Communication Interface - Hardware foundation]] 
- TCP/IP连接出现大问题, 但已经解决(by kimi K2). 

### TCP/IP连接 起末 by kimi K2

- [Kimi - Fixing LAN connection](https://www.kimi.com/chat/d2daugulv3kab8rojbq0) google hall junction account, by the way, `0x`是16进制前缀. 
- [Kimi - obsidian批量增删#没有什么好办法, `Ctrl + H`是比较凑合的一种方案](https://www.kimi.com/chat/d2daugulv3kab8rojbq0) 

User: 你好, 我尝试用LAN口连接一个硬件设备, 发现LAN口绿灯常亮, 黄灯闪烁, 然而却cmd ping不到ip地址
Kimi: 你好！根据你描述的现象——**LAN口绿灯常亮、黄灯闪烁**，但**CMD ping不到IP地址**，我们可以一步步排查问题：

---

#### ✅ 1. **确认物理连接是否正常**

- **绿灯常亮**：通常表示物理连接已建立（链路up）。
- **黄灯闪烁**：通常表示有数据传输（但不一定是有效数据）。

> ✅ 结论：物理层连接基本正常，问题可能出在**网络层或配置层**。

---

#### ✅ 2. **确认你ping的是正确的IP地址**

- 你知道你要连接的硬件设备的IP地址吗？（比如 192.168.1.100）
- 你是否确认这个IP地址是**静态设置**的，还是**DHCP分配的**？
- 你是否知道你的电脑当前获取的IP地址？（在CMD中输入 `ipconfig` 查看）

---

#### ✅ 3. **检查你电脑的IP配置**

在CMD中输入：
```bash
ipconfig
```
看看你的**以太网适配器**（不是Wi-Fi）是否获取到了一个IP地址，比如：
```
IPv4 地址 . . . . . . . . . . . . : 192.168.1.10
子网掩码 . . . . . . . . . . . . : 255.255.255.0
默认网关 . . . . . . . . . . . . : 192.168.1.1
```

- 如果显示的是 `169.254.x.x`，说明**没有获取到IP**，可能是DHCP失败。
- 如果是 `0.0.0.0` 或空白，说明网卡没启用或驱动异常。

---

#### ✅ 4. **尝试手动设置IP地址**

如果你知道目标设备的IP段（比如 192.168.1.100），你可以手动设置你电脑的IP为同一网段：
```bash
控制面板 → 网络和共享中心 → 更改适配器设置 → 右键以太网 → 属性 → IPv4 → 使用以下IP地址
```
例如：
- IP地址：192.168.1.99
- 子网掩码：255.255.255.0
- 默认网关：192.168.1.1（可不填）

然后再次尝试 ping：
```bash
ping 192.168.1.100
```

---

#### ✅ 5. **确认目标设备是否响应ARP**

在CMD中输入：
```bash
arp -a
```
看看是否有你目标IP的MAC地址记录。如果没有，说明**设备可能没有响应ARP请求**，可能是：
- IP地址设置错误
- 设备未启用ICMP响应
- 防火墙阻止了ping

---

#### ✅ 6. **检查目标设备是否支持ping**

有些嵌入式设备或工业硬件**默认关闭ping响应**（ICMP），即使网络通，也不会回应ping。

你可以尝试：
- 用telnet或浏览器访问设备的IP地址（如 http://192.168.1.100）
- 使用串口或USB连接设备查看其网络配置
- 查看设备说明书，确认默认IP和是否支持ping

---

#### ✅ 7. **尝试用交叉线或直连线**

虽然现代网卡大多支持自动翻转（Auto-MDIX），但极少数老旧设备可能需要**交叉线**才能通信。

---

#### ✅ 总结建议

| 检查项 | 建议 |
|--------|------|
| IP地址是否正确 | 确认目标设备IP，手动设置电脑IP |
| DHCP是否开启 | 若设备无DHCP，需手动设置IP |
| 是否响应ping | 尝试telnet、web访问或串口调试 |
| 防火墙或ICMP设置 | 检查设备是否禁ping |
| 驱动或网卡状态 | 确认网卡启用、驱动正常 |

---

如果你能告诉我：
- 你设备的**品牌和型号**
- 你知道的**目标IP地址**
- 你电脑的**ipconfig输出**

我可以给你更具体的建议。
User: 也就是说, 问题可能在于pc与设备的默认网关不是同一个?
Kimi: **不一定。**  
在“一根网线直连”这种最简单的场景里，**根本不需要网关**——两台设备只要 IP 地址在同一网段（子网掩码一致即可），就能二层互通，ARP 广播就能找到对方。网关只在“跨网段通信”时才起作用。

所以：

1. 直连场景下，把 PC 的网关留空也行；网关不同不会导致 ping 不通。  
2. 真正可能出问题的点还是：
   • IP 不在同一网段（或子网掩码不一致）  
   • 其中一方根本没设 IP / DHCP 失败  
   • 对方设备禁 ICMP（不响应 ping）  
   • 电脑或设备有本地防火墙拦截

快速验证：  
```
PC：192.168.1.2 / 255.255.255.0  
设备：192.168.1.100 / 255.255.255.0
```
网关随便填不填都行，再 `ping 192.168.1.100` 试一下。
User: 我看到了, pc的默认网关是255.255.0.0, 而设备的是255.255.255.0, 不一样
Kimi: 那不是“默认网关”，而是“子网掩码”（Subnet Mask）。  
- **子网掩码 255.255.0.0** 与 **255.255.255.0** 不同，会导致两台设备认为它们不在同一子网，于是 ARP 广播不到对方，自然 ping 不通。

#### 快速解决办法

把 PC 的以太网口改成与设备相同的掩码即可（最简单的是两边都用 255.255.255.0）。步骤：

1. 打开 **控制面板 → 网络和共享中心 → 更改适配器设置**  
2. 右键你的 **以太网** → **属性 → Internet 协议版本 4 (TCP/IPv4)**  
3. 选 **使用下面的 IP 地址**，例如：  
   • IP 地址：192.168.1.99  
   • 子网掩码：255.255.255.0  
   • 默认网关：留空（直连不需要网关）  
4. 确定 → 禁用再启用一次网卡，或重启电脑  
5. 再次 `ping 192.168.1.100`（或设备实际 IP）

只要双方 IP 处于同一网段（如 192.168.1.x/24），就能通了。
User: pc: 
以太网适配器 以太网 3:

   连接特定的 DNS 后缀 . . . . . . . :
   本地链接 IPv6 地址. . . . . . . . : fe80::e1fa:2190:5b67:f24a%46
   自动配置 IPv4 地址 . . . . . . . : 169.254.131.82
   子网掩码 . . . . . . . . . . . . : 255.255.0.0
   默认网关. . . . . . . . . . . . . :

device:
ip: 192.168.1.120
255.255.0.0
192.168.1.1
8.8.8.8
Kimi: 现在问题非常清楚了：

- **PC 端**  
  拿到的是 APIPA 地址 `169.254.131.82/255.255.0.0`，说明 **没有成功从设备或 DHCP 服务器拿到 IP**。  
- **设备端**  
  固定 IP `192.168.1.120/255.255.0.0`，网关 `192.168.1.1`，DNS `8.8.8.8`。

#### 为什么 ping 不通

1. 子网掩码虽然都是 `255.255.0.0`，但 PC 的 169.254.x.x 与设备的 192.168.1.x **根本不在同一网段**。  
2. PC 没有 192.168.1.x 地址，ARP 广播不到设备，自然 ping 不到 `192.168.1.120`。  
3. PC 端没有网关，169.254.x.x 也无法跨网段去 192.168.1.x。

---

#### 一步到位解决

把 PC 手动设成与设备同网段即可：

**Windows 设置步骤：**

1. 控制面板 → 网络和共享中心 → 更改适配器设置  
2. 右键“以太网 3” → 属性 → IPv4 → 使用以下 IP 地址  
   - IP 地址：**192.168.1.99**（随便挑 192.168.1.2–254 中一个未占用的）  
   - 子网掩码：**255.255.255.0**（或 255.255.0.0 也行，但 255.255.255.0 更直观）  
   - 默认网关：**留空**（直连不需要）  
   - DNS：**可留空**  
3. 确定 → 禁用/启用一次网卡  
4. 在 CMD 里再执行  
   ```
   ping 192.168.1.120
   ```

此时应当能收到回应。如果仍不通，再排查设备是否禁 ping、防火墙或线缆问题。
User: 可以去设置device的network config吗
Kimi: 可以，但得看设备本身提供哪种接口。

常见做法（按出现频率排序）：

1. **Web 页面**  
   很多嵌入式/工业硬件只要和它在同一网段，浏览器里直接访问  
   ```
   http://192.168.1.120
   ```  
   就能打开配置页；在里面把 IP、子网掩码、DHCP 开关改掉，保存重启即可。

2. **厂商配置软件**  
   部分设备（PLC、相机、采集卡等）会附带“Search/Config Tool”——在官网下载后一键扫描，双击就能改网络参数。

3. **串口 / USB Console**  
   如果设备有 RS-232/RS-485 或 Micro-USB Console，用串口线/调试线 + 串口终端（115200 8N1 常见）进去敲命令改 IP。

4. **硬件拨码 / 按键**  
   极少数老设备用拨码开关或长按复位键恢复出厂，再按说明书重新设。

5. **Telnet / SSH**  
   若设备开了 Telnet/SSH（端口 23/22），用  
   ```
   telnet 192.168.1.120
   ```  
   或  
   ```
   ssh root@192.168.1.120
   ```  
   登录后修改配置文件或直接敲命令。

---

#### 你现在可以做的

- 先把 PC 手动设到 192.168.1.99/255.255.255.0（前面已说明）。  
- 浏览器访问 `http://192.168.1.120` 试试看。  
- 若打不开，用厂商的搜索工具或检查设备标签/说明书，看有没有“默认 IP”“Console 口”“恢复出厂键”等信息。

如果你告诉我设备品牌和型号，我可以直接给出具体口令或工具下载链接。
User: 额, 我想知道调整我的以太网配置会不会产生其他问题
Kimi: 一般情况下，**只把“以太网 3”这一张有线网卡改成固定 IP**（192.168.1.99/255.255.255.0）不会给系统、Wi-Fi 或其它程序带来副作用，但下面几点你最好提前心里有数：

1. **仅影响这一张网卡**  
   你改的是“以太网 3”，Wi-Fi、VPN、虚拟机网卡都保持原样，不会有冲突。

2. **不再自动获取公司/家用的 DHCP 地址**  
   如果这根网线以后插回公司或家里的路由器，而你还保留着 192.168.1.99/255.255.255.0，就可能和局域网不在同一网段，导致“没网”。  
   → 用完设备后把 IPv4 设回“自动获取”即可，或者 Windows 10/11 可以“备用配置”里填两套：  
   ```
   常规：自动获取  
   备用：192.168.1.99 / 255.255.255.0
   ```
   这样插回路由器时仍然能正常上网。

3. **与 VPN/虚拟机冲突概率极低**  
   除非你自己在 VirtualBox/VMware 里把虚拟网卡也改成 192.168.1.x，否则不会冲突。

4. **防火墙规则**  
   Windows Defender 默认按“专用网络/公用网络”区分，不会因为你换了固定 IP 就突然拦截，除非你手动改过高级规则。

#### 一句话总结  

临时改这一根直连网卡的风险几乎为零，**用完记得改回“自动获取”**就行；或者干脆用上面提到的“备用配置”双保险。
User: 你建议我改pc还是改device
Kimi: **优先改 PC，不改设备。**

原因：

1. **风险最小**  
   改 PC 只是临时把“以太网 3”设成静态 IP，用完再切回“自动获取”即可；不会对设备固件造成任何影响，也不会破坏设备现有的网络设定。  
2. **操作简单**  
   Windows 图形界面 30 秒就能改完，不需要登录设备控制台、找串口线或担心改错参数导致设备失联。  
3. **可逆性强**  
   一旦改设备，若 IP/掩码/网关填错，设备可能直接“失联”，还得找 Console 或恢复出厂才能救回。改 PC 随时改回来。

#### 建议步骤（再确认一次）

1. 给 PC 的“以太网 3”手动设：  
   IP：192.168.1.99  
   掩码：255.255.255.0  
   网关、DNS：留空  
2. 浏览器直接访问 `http://192.168.1.120` 或 `ping 192.168.1.120` 验证连通。  
3. 调试完后把 PC 的 IPv4 改回“自动获取”，插回原来的网络即可正常上网。

除非设备手册明确要求必须改设备 IP 才能继续后续配置，否则先不动设备。
User: 到这里, 应当如何进一步控制?
Kimi: **状态已确认：**

- 网卡 **已启用**、**100 Mbps 全双工**、**TX/RX 计数正常** → 物理链路 OK  
- **IPv4 连接：无网络访问权限** → 仍未拿到有效 IP，问题就在 **IP 配置** 上  

---

#### ✅ 下一步：给 “以太网 3” 手动写死一个和设备同网段的地址

1. 在刚才的窗口里  
   **双击** `Internet 协议版本 4 (TCP/IPv4)`  
   或点击 **属性(R)** → 进入 IPv4 设置页。

2. 选择 **使用下面的 IP 地址**  
   ```
   IP 地址：192.168.1.99
   子网掩码：255.255.255.0
   默认网关：留空
   首选 DNS：留空（或 8.8.8.8 都行）
   ```

3. **确定 → 关闭 → 禁用再启用一次 “以太网 3”**（或插拔一次网线）  
   这样 Windows 会立即用新 IP 重新协商。

4. **验证**  
   Win+R → `cmd` →  
   ```
   ping 192.168.1.120
   ```
   看到 `Reply from 192.168.1.120` 就 OK 了！

---

#### 🔄 事后可逆

用完设备后，把 IPv4 设回 **“自动获取”**，插回公司/家路由器即可恢复原来上网。
User: 感谢你, 完成网络配置, 现在已经可以ping到我的MSO5000 device了. 
by the way, 为什么我在计算机领域看到过如此之多的 '0x'字符
Kimi: 恭喜搞定！

至于“0x”，它是 **十六进制常量的前缀**，源自 C/C++ 语法，在计算机领域几乎无处不在：

1. **为什么用十六进制？**  
   - 二进制太长，十进制又不直观，16 进制刚好 4 位二进制对应 1 位，一眼能看出字节、位字段。  
   - 例如 `0xFF = 1111 1111b = 255d`，省空间又易读。

2. **“0x”本身不是数值**，只是告诉编译器/调试器/人“后面是 HEX”。  
   类似地：  
   - `0b` 前缀 → 二进制  
   - `0` 前缀 → 八进制  

3. **在哪儿会看到？**  
   - 内存地址：`0x7FFEE3C7A000`  
   - 颜色码：`#0xRRGGBB`  
   - 寄存器/标志位：`0x4000 0000` 表示某个 bit 置位  
   - 协议报文：以太网类型 `0x0800`（IPv4）  
   - MCU 手册：GPIO 基址 `0x4002 1000`

所以“0x”出现的频率 ≈ 我们写数字写十进制一样自然——只是计算机世界更偏爱十六进制而已。

![[Pasted image 20250812114637.png]] 

### 进一步MSO连接

- 使用`python`的`pyside6, pyvisa`配合NI-VISA实现了对MSO的连接、控制与GUI制作. 
- 下一步总得做点什么: **那么就这样, 实现一个我一手控制UTG900E输入扫频, 一手控制MSO输出图像并在Qt GUI中导出的项目**.  

## MSO + UTG + VISA + Qt

- 始终在失败:
	- TCPIP USB 串扰. [这个问题本质上没有影响] 
	- thread processor 区别. [这个问题最终没有影响] 
	- 单双`visa resourcemanager`区别. [这个问题还是最好注意一下] 
	- get 到控制变量法的关键在于维护一个工作流栈`stack of workflow`, 将物理层, 技术栈、具体的抽象code都放入一个栈中, 以控制变量纠错, 在这个过程中层间通信也应当被考虑. 
		- 在这个控制变量的过程中, 有下列工具可供使用:
			- Manual
			- Forum
- **Qserial控制utg是崔师兄给出的方案.** 
- 尝试使用NI VISA test panel手动收发命令和数据, **成功实现**对UTG和MSO的同时控制. 
	- 成功实现. 
	- 进一步分析, 问题一定在于当前工作栈的上一层, 可能是python的问题, 我应该尝试换用cpp实现一边当前项目. 
	- 另一种可能性是: 我的人手太慢了, 而计算机太快了. 
	- 问题应该集中在`get_live_waveform()`方法上. 

**20250813**: 
- 第一步竟然倒在了一个`np.uint8 TypeError`上面. 
- 第二部是倒在了该函数的数据类型时改错了函数, 应当该`get_full_waveform()`, 改成了`get_live_waveform`. 
	- 改写`'B'` 
	- 改写`'uint8'`的`numpy`类型升级逻辑
- 现在发现, 问题还在于使用了`:WAV:MODE: RAW`, 导致大量(16MB)原始数据直接通过TCPIP传播, 这过于耗时了, 应该使用`:WAV:MODE: NORMAL`, 这个数据量小很多, 可以做到. 
- 又一个问题: `.py`文件的python解释器位置不是cmd行首`()`, 行首`()`是conda env, 解释器位置是下图所示红框位置. ![[Pasted image 20250813140257.png]]
- 使用和学习了Thread的含义与用法. 

## Hikrobot MV-CA004-10UM image preview

![[Pasted image 20250813160655.png]] 
- go to [Hikrobot - Machine Vision - Service - Download Center](https://www.hikrobotics.com/en/machinevision/service/download/) 下载MVS(包含上图的图像化用户界面)和MVS_SDK(包含`.h`和`.lib`的库). 
- 明确连接渠道: 
	- Hikrobot MV-CA004-10UM $\to$ USB $\to$ MVS. 直接实现上图图像化用户界面. 
	- Hikrobot MV-CA004-10UM $\to$ USB $\to$ MVS_SDK (`.h,.lib`文件) $\to$ Visual Studio `.cpp, .ui (Qt)`文件. **这条渠道所示方案是当前需求方案**.
- [‎Gemini - Hikrobot 相机 UI 嵌入指南](https://g.co/gemini/share/e8b7de53ca4e) 整个方案实现过程, 它包括: 
	- Qt安装: [zhihu - qt安装教程](https://zhuanlan.zhihu.com/p/697911596) 
	- Visual Studio环境配置: [‎Gemini - Hikrobot 相机 UI 嵌入指南](https://g.co/gemini/share/e8b7de53ca4e) 
	- `.cpp, .h`文件撰写, 它们包括: 
		- 外部导入的
			```cpp
			#include <QApplication>
			#include <QWidget>
			#include <QPushButton>
			#include <QTextEdit>
			#include <QVBoxLayout>
			#include <QMessageBox>
			#include <QCloseEvent>               
			```
		- 手动编译的相机类`MVCamera.cpp,MVCamera.h`. 
		- 手动编译的Qt GUI类`MVCameraQtWidget.cpp, MVCameraQtWidget.h`. 
		- `main.cpp`

## Hikrobot MV-CA004-10UM image preview powered by `python`

调研如何使用`python`调用`cpp`的SDK. 

## Hikrobot MV-CA004-10UM total GUI

当前的任务是: 继续给相机加入其他的模块, 将官方MVS软件的GUI功能实现出来. 
- 设备列表和设备信息模块. 
- 参数调节模块. 
- 图像预览模块. 
- 拍照和录像模块. 

## 深入研究MVS `.h, .lib`的各个模块

new conceptions: 
- `grabber` 
- `handle` 
- `buffer` 
- `callback` **multi thread and async tasks** 
	No, **a callback is not inherently tied to multithreading, multiprocessing, or parallelization, but offten.** 
	A callback is simply a programming pattern where you pass a function (`A`) as an argument to another function (`B`). Function `B` can then "call back" to function `A` whenever it needs to. This can happen in a single thread or across multiple threads.
	The confusion arises because callbacks are a _very popular and effective tool_ for **handling asynchronous tasks, which are often managed with multiple threads.** 

## Hikrobot 虚拟相机试用

## MvCameraControl

```cpp
#include balabala,etc
```

# MyProject 器件部

## 四芯光纤纤芯定位

go to git clone `MultiCoreDection`. 

事实上, 这并不是一个多么困难的问题, 交给计算机系的大学生或许只需要4h就能做完, 我tm甚至应该去做项目经理对外分发这样的任务. 

### proj file roles

- `demo/fiberDectionRough`: find the left and right boundaries of fiber

## 光纤珊点与标记调度

等了解了整个机器之后再说. 

## 华为矩形反射谱需求

- [x] 已经实现rectangle 波形. √
- [x] 倾斜切趾的功率切趾等效是什么? 
- [x] 将参数转换到(-1,1)范围内, 实现跑到实际仪器上. [Gemini - fft, fftfreq与单位制转换的系统化思路](https://g.co/gemini/share/50b998ee0af4) √
- [x] 试试算解析解, 利用一些rectangle函数的delta特性. 

是否可以使用Bayesian Parameters Machine: [Gemini - 不可微优化问题与Bayesian寻参](https://g.co/gemini/share/f4367edfefc4) 

### 纵向功率切趾结果: 

![[cd833bffd6c8cb6bdc598904ddd73e2.png|1491]]
![[c6d6c6b91f033d118300a66088778d9.png|1126]]
![[1c80c1f4116825628c7fa3c96a996bb.jpg|979]] 
![[e7c6f74f80bc14e24a6b6a2932fbfe8.png|1499]]

### 倾斜切趾的功率切趾对位

- [Gemini - 倾斜切趾与高斯切趾不等效](https://g.co/gemini/share/b8279f9fe5f1)

对于倾斜切趾, 有: 
$$
\begin{align}
 & \text{laser focal point obey}: x = \alpha z \\
 & \text{laser focal point distance}: \Delta x  \\
 & n(x_{0},y_{0},z_{0}) \propto \int \mathrm{d}x\mathrm{d}y \mathrm{d}z \sum_{i} \text{n\_kernel}(x_{0}-x,y_{0}-y,z_{0}-z) \delta(x-\alpha z) \delta(x-i\Delta x)
\end{align}
$$
类似地, 功率高斯切趾为: 
$$
\begin{align}
n(x_{0},y_{0},z_{0}) \propto \int\mathrm{d}x\mathrm{d}y\mathrm{d}z \sum_{i} \text{n\_kernel}(x_{0}-x,y_{0}-y,z_{0}-z) \exp\left( -\frac{1}{2} \left( \frac{z}{\sigma} \right)^{2}\right) \delta(x-i\Delta x)
\end{align}
$$

打一个gaussian beam上去, 反射谱有多大不同? 

很难说有多少不同啊... 

### 形式解`rectangle(f0,HW,f)` 

-  [rect频谱形式解](https://g.co/gemini/share/49116a2f7e03)

**if** $\text{Fourier}[\text{env}\times\text{per}] = \text{rect}(x)$

$$
f_0 t + \text{mod}(t) \cdot t = f_0 t
$$$$
\text{mod}(t) \cdot t = 0
$$$$
\text{mod}(t) = 0
$$
**elif** $\text{abs}\{\text{Fourier}[\text{env}\times \text{per}]\} = \text{rect}(x)$ 
cannot solve. 


### 下一步抗噪能力探索

- [x] 低频噪声. √ 很明确的是, 
- [x] 保持张力恒定. 
	zhixvan表示这里没有可能性. 
	经模拟验证, 其效果不会达到当前水平. 	

![[Pasted image 20250825110321.png|985]]   
- [x] **光纤本身的波动，涂覆层，包层，纤芯同心度差.**
	那么要换光纤吗? 没法换光纤, 只能机械调整光纤纤芯稳定性. 

### 光纤yz轴波动, coating, cladding, core同心度问题. 

光纤的yz轴波动, 同心度问题可能引起更大的等效功率切趾噪声. 

- 在位移台yz轴上加反馈调制√
- 买更好的光纤×
